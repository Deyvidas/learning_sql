- [Создание пустой таблицы](#1)
- [Добавление записей в таблицу](#2)
- [INSERT INTO SELECT mysql-tutorial](https://www.mysqltutorial.org/mysql-insert-into-select/)
- [Добавление записей из другой таблицы](#3)
- [Добавление записей из другой таблицы (с вложенным запросом)](#4)
- [UPDATE mysql-tutorial](https://www.mysqltutorial.org/mysql-update-data.aspx)
- [Изменение существующих записей в таблице](#5)
- [Запросы на обновление нескольких таблиц](#6)
- [DELETE mysql-tutorial](https://www.mysqltutorial.org/mysql-delete-statement.aspx)
- [Запросы на удаление](#7)
- [Запросы на создание таблицы на основе другой таблицы](#8)

---

<h3 id="1" align="center">Создание пустой таблицы</h3>

```sql
CREATE TABLE IF NOT EXISTS supply(supply_id INT PRIMARY KEY AUTO_INCREMENT,
                                      title VARCHAR(50),
                                     author VARCHAR(30),
                                      price DECIMAL(8, 2),
                                     amount INT);
```
```sql
SHOW COLUMNS FROM supply;
```
```text
Field    |Type        |Null|Key|Default|Extra         |
---------+------------+----+---+-------+--------------+
supply_id|int         |NO  |PRI|       |auto_increment|
title    |varchar(50) |YES |   |       |              |
author   |varchar(30) |YES |   |       |              |
price    |decimal(8,2)|YES |   |       |              |
amount   |int         |YES |   |       |              |
```
---

<h3 id="2" align="center">Добавление записей в таблицу</h3>

```sql
INSERT INTO supply(title, author, price, amount)
     VALUES ('Лирика', 'Пастернак Б.Л.', 518.99, 2),
            ('Черный человек', 'Есенин С.А.', 570.20, 6),
            ('Белая гвардия', 'Булгаков М.А.', 540.50, 7),
            ('Идиот', 'Достоевский Ф.М.', 360.80, 3);
```
```sql
SELECT * FROM supply;
```
```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6|
        3|Белая гвардия |Булгаков М.А.   |540.50|     7|
        4|Идиот         |Достоевский Ф.М.|360.80|     3|
```

---

<h3 id="3" align="center">Добавление записей из другой таблицы</h3>

С помощью запроса на добавление можно не только добавить в таблицу конкретные
значения (список VALUES), но и записи из другой таблицы, отобранные с помощью
запроса на выборку. В этом случае вместо раздела VALUES записывается запрос на
выборку, начинающийся с SELECT. В нем можно использовать WHERE, GROUP BY,
HAVING, ORDER BY, а так-же и вложенные запросы.
```sql
INSERT INTO <tbl_name>(<field_1>, ..., <field_n>)
     SELECT <field_1>, ... <field_n>
       FROM <tbl_name>
      WHERE <condition>
   GROUP BY <field>
     HAVING <condition>
   ORDER BY <field>
```
<p align="center">~~~</p>
Пример:

Занести все книги из таблицы supply в таблицу book.
```sql
INSERT INTO book(title, author, price, amount)
     SELECT title, author, price, amount
       FROM supply;
```
```sql
SELECT * FROM book;
```
```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5| <-
      3|Идиот                |Достоевский Ф.М.|460.00|    10| <-
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
      8|Лирика               |Пастернак Б.Л.  |518.99|     2|
      9|Черный человек       |Есенин С.А.     |570.20|     6|
     10|Белая гвардия        |Булгаков М.А.   |540.50|     7| <- ДУБЛИКАТ
     11|Идиот                |Достоевский Ф.М.|360.80|     3| <- ДУБЛИКАТ
```
> С помощью этого запроса в таблицу book включены все книги из supply, даже те,
которые в book уже есть («Белая гвардия» и «Идиот»). В результате в таблице
одна и та же книга, например «Белая гвардия», имеет код 2 и 10. __Для
реляционной модели это нежелательная ситуация__. Устранить эту проблему можно с
помощью вложенных запросов, которые будут рассмотрены в следующем шаге.
<p align="center">~~~</p>
Задание:

Добавить из таблицы supply в таблицу book, все книги, кроме книг, написанных
Булгаковым М.А. и Достоевским Ф.М.
```sql
INSERT INTO book(title, author, price, amount)
     SELECT title, author, price, amount
       FROM supply
      WHERE author NOT IN ('Булгаков М.А.', 'Достоевский Ф.М.');
```
```sql
SELECT * FROM supply;
```
```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6|
        3|Белая гвардия |Булгаков М.А.   |540.50|     7| <- ОТСЕЯТЬ
        4|Идиот         |Достоевский Ф.М.|360.80|     3| <- ОТСЕЯТЬ
```
```sql
SELECT * FROM book;
```
```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5|
      3|Идиот                |Достоевский Ф.М.|460.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
      8|Лирика               |Пастернак Б.Л.  |518.99|     2| <- НОВАЯ ЗАПИСЬ
      9|Черный человек       |Есенин С.А.     |570.20|     6| <- НОВАЯ ЗАПИСЬ
```
> Таким образом мы избавились от дубликатов, но это не совсем удобный способ,
лучше всего применять фильтрацию с вложенным запросом.

---

<h3 id="4" align="center">Добавление записей из другой таблицы (с вложенным запросом)</h3>

__Для предотвращения дублирования записей при вставке из другой таблицы нужно
применять вложенный запрос.__

<p align="center">~~~</p>

Пример:

Занести из таблицы supply в таблицу book только те книги, названия которых
отсутствуют в таблице book.
```sql
INSERT INTO book(title, author, price, amount)
     SELECT title, author, price, amount
       FROM supply
      WHERE title NOT IN (SELECT DISTINCT title
                                     FROM book);
```
```sql
SELECT DISTINCT title
           FROM book;
```
```sql
title                |
---------------------+
Мастер и Маргарита   |
Белая гвардия        |
Идиот                |
Братья Карамазовы    |
Игрок                |
Стихотворения и поэмы|
```
```sql
SELECT * FROM supply;
```
```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6|
        3|Белая гвардия |Булгаков М.А.   |540.50|     7| <- ОТСЕЯТЬ
        4|Идиот         |Достоевский Ф.М.|360.80|     3| <- ОТСЕЯТЬ
```
```sql
SELECT * FROM book;
```
```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5|
      3|Идиот                |Достоевский Ф.М.|460.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
      8|Лирика               |Пастернак Б.Л.  |518.99|     2| <- НОВАЯ ЗАПИСЬ
      9|Черный человек       |Есенин С.А.     |570.20|     6| <- НОВАЯ ЗАПИСЬ
```

<p align="center">~~~</p>

Задание:

Занести из таблицы supply в таблицу book только те книги, авторов которых нет в
book.
```sql
INSERT INTO book(title, author, price, amount)
     SELECT title, author, price, amount
       FROM supply
      WHERE author NOT IN (SELECT DISTINCT author
                                      FROM book);
```
```sql
SELECT DISTINCT author
           FROM book;
```
```text
author          |
----------------+
Булгаков М.А.   |
Достоевский Ф.М.|
Есенин С.А.     |
```
```sql
SELECT * FROM supply;
```
```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6| <- ОТСЕЯТЬ
        3|Белая гвардия |Булгаков М.А.   |540.50|     7| <- ОТСЕЯТЬ
        4|Идиот         |Достоевский Ф.М.|360.80|     3| <- ОТСЕЯТЬ
```
```sql
SELECT * FROM book;
```
```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5|
      3|Идиот                |Достоевский Ф.М.|460.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
      8|Лирика               |Пастернак Б.Л.  |518.99|     2| <- НОВАЯ ЗАПИСЬ
```

---

<h3 id="5" align="center">Изменение существующих записей в таблице</h3>

Синтаксис:
```sql
UPDATE <tbl_name>
   SET <field_1> = <expr_1>,
       <field_2> = <expr_2>
 WHERE <condition_1>;
```
<p align="center">~~~</p>
Пример 1:

Уменьшить на 30% цены всех книг в таблице book.
```sql
UPDATE book
   SET price = price * 0.7;
```

<details><summary>Таблица до</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5|
      3|Идиот                |Достоевский Ф.М.|460.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```

</details>
<details><summary>Таблица после</summary>

```sql
SELECT * FROM book;
```
```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |469.69|     3|
      2|Белая гвардия        |Булгаков М.А.   |378.35|     5|
      3|Идиот                |Достоевский Ф.М.|322.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|559.31|     3|
      5|Игрок                |Достоевский Ф.М.|336.35|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |455.00|    15|
```

</details>

> С помощью запросов на обновление можно изменять не все записи в таблице (как
в предыдущем запросе), а только часть из них. Для этого в запрос включается
ключевое слово WHERE, после которого указывается условие отбора строк для
изменения.
<p align="center">~~~</p>
Пример 2:

Уменьшить на 30% цену тех книг в таблице book, количество которых меньше 5.
```sql
UPDATE book
   SET price = price * 0.7
 WHERE amount < 5;
```

<details><summary>Таблица до</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3| <- ИЗМЕНИТЬ
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5|
      3|Идиот                |Достоевский Ф.М.|460.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3| <- ИЗМЕНИТЬ
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```

</details>
<details><summary>Таблица после</summary>

```sql
SELECT * FROM book;
```
```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |469.69|     3| <- ИЗМЕНИЛИ
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5|
      3|Идиот                |Достоевский Ф.М.|460.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|559.31|     3| <- ИЗМЕНИЛИ
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```

</details>

<p align="center">~~~</p>

Задание:

Уменьшить на 10% цену тех книг в таблице book, количество которых принадлежит
интервалу от 5 до 10, включая границы.
```sql
UPDATE book
   SET price = price * 0.9
 WHERE amount BETWEEN 5 AND 10;
```

<details><summary>Таблица до</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5| <- ИЗМЕНИТЬ
      3|Идиот                |Достоевский Ф.М.|460.00|    10| <- ИЗМЕНИТЬ
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10| <- ИЗМЕНИТЬ
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```

</details>

<details><summary>Таблица после</summary>

```sql
SELECT * FROM book;
```
```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |486.45|     5| <- ИЗМЕНИЛИ
      3|Идиот                |Достоевский Ф.М.|414.00|    10| <- ИЗМЕНИЛИ
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|432.45|    10| <- ИЗМЕНИЛИ
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```

</details>

<p align="center">~~~</p>

> Запросом UPDATE можно обновлять значения нескольких столбцов одновременно.

Задание:

В таблице book необходимо скорректировать значение для покупателя в столбце buy
таким образом, чтобы оно не превышало количество экземпляров книг, указанных в
столбце amount. А цену тех книг, которые покупатель не заказывал, снизить на
10%.

```sql
UPDATE book
   SET   buy = IF(buy > amount, amount, buy),
       price = IF(buy = 0, price * 0.9, price);
```

<details><summary>Таблица до</summary>

```text
+----+-----------------------+------------------+--------+--------+-----+
| id | title                 | author           | price  | amount | buy |
+----+-----------------------+------------------+--------+--------+-----+
| 1  | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      | 0   | <- СНИЗИТЬ price
| 2  | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 3   |
| 3  | Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 8   |
| 4  | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      | 0   | <- СНИЗИТЬ price
| 5  | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 18  | <- УМЕНЬШИТЬ buy
+----+-----------------------+------------------+--------+--------+-----+
```

</details>

<details><summary>Таблица после</summary>

```text
+----+-----------------------+------------------+--------+--------+-----+
| id | title                 | author           | price  | amount | buy |
+----+-----------------------+------------------+--------+--------+-----+
| 1  | Мастер и Маргарита    | Булгаков М.А.    | 603.89 | 3      | 0   | <- СНИЗИЛИ price
| 2  | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 3   |
| 3  | Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 8   |
| 4  | Братья Карамазовы     | Достоевский Ф.М. | 719.11 | 2      | 0   | <- СНИЗИЛИ price
| 5  | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 15  | <- УМЕНЬШИЛИ buy
+----+-----------------------+------------------+--------+--------+-----+
```

</details>

---

<h3 id="6" align="center">Запросы на обновление нескольких таблиц</h3>

- для столбцов, имеющих одинаковые имена, необходимо указывать имя таблицы, к
  которой они относятся, например, book.price – столбец price из таблицы book,
  supply.price – столбец price из таблицы supply;
- все таблицы, используемые в запросе, нужно перечислить после ключевого слова
  UPDATE;
- в запросе обязательно условие WHERE, в котором указывается условие при
  котором обновляются данные.

<p align="center">~~~</p>

Синтаксис:
```sql
UPDATE <tbl_name1>, <tbl_name2>
   SET <tbl_name1>.<field_name1> = <expression1>,
       <tbl_name2>.<field_name1> = <expression2>
 WHERE <condition1>;
```
> После инструкции UPDATE, обязательно указываются все таблицы, которые
используются после SET или WHERE.

<p align="center">~~~</p>

Пример:
Если в таблице supply есть те же книги, что и в таблице book, добавлять эти
книги в таблицу book не имеет смысла. Необходимо увеличить их количество на
значение столбца amount таблицы supply.

```sql
UPDATE book, supply
   SET book.amount = book.amount + supply.amount
 WHERE book.title = supply.title
   AND book.author = supply.author;
```

<details><summary>Таблицы book, supply до</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5| <- ДОБАВИТЬ 7 к amount
      3|Идиот                |Достоевский Ф.М.|460.00|    10| <- ДОБАВИТЬ 3 к amount
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```
```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6|
        3|Белая гвардия |Булгаков М.А.   |540.50|     7| <-
        4|Идиот         |Достоевский Ф.М.|360.80|     3| <-
```

</details>

<details><summary>Таблицы book, supply после</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|    12| <- ДОБАВЛЕНО 7 к amount
      3|Идиот                |Достоевский Ф.М.|460.00|    13| <- ДОБАВЛЕНО 3 к amount
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```
```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6|
        3|Белая гвардия |Булгаков М.А.   |540.50|     7| <-
        4|Идиот         |Достоевский Ф.М.|360.80|     3| <-
```

</details>

<p align="center">~~~</p>

Задание:

Для тех книг в таблице book, которые есть в таблице supply, не только увеличить
значение столбца amount, но и пересчитать их цену (для каждой книги найти сумму
цен из таблиц book и supply и разделить на 2).

```sql
UPDATE book, supply
   SET book.price = ROUND((book.price + supply.price) / 2, 2),
       book.amount = book.amount + supply.amount
 WHERE book.title = supply.title
   AND book.author = supply.author;
```

<details><summary>Таблицы book, supply до</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5| <- ДОБАВИТЬ 7 к amount ПЕРЕ-РАССЧИТАТЬ price
      3|Идиот                |Достоевский Ф.М.|460.00|    10| <- ДОБАВИТЬ 3 к amount ПЕРЕ-РАССЧИТАТЬ price
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```
```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6|
        3|Белая гвардия |Булгаков М.А.   |540.50|     7| <-
        4|Идиот         |Достоевский Ф.М.|360.80|     3| <-
```

</details>

<details><summary>Таблицы book, supply после</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|    12| <- ДОБАВЛЕНО 7 к amount ПЕРЕ-РАССЧИТАНО ЗНАЧЕНИЕ price
      3|Идиот                |Достоевский Ф.М.|410.40|    13| <- ДОБАВЛЕНО 3 к amount ПЕРЕ-РАССЧИТАНО ЗНАЧЕНИЕ price
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3|
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```
```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6|
        3|Белая гвардия |Булгаков М.А.   |540.50|     7| <-
        4|Идиот         |Достоевский Ф.М.|360.80|     3| <-
```

</details>

---

<h3 id="7" align="center">Запросы на удаление</h3>

Синтаксис:

```sql
-- Удалить ВСЕ записи в таблице;
DELETE FROM <tbl_name>;
```
```sql
DELETE FROM <tbl_name>
      WHERE <condition>
      LIMIT <row_count>;  -- Лимит на кол-во удаляемых записей;
```

<p align="center">~~~</p>

Пример 1:

Очистить таблицу supply.

```sql
DELETE FROM supply;
```

<details><summary>Таблица supply до</summary>

```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6|
        3|Белая гвардия |Булгаков М.А.   |540.50|     7|
        4|Идиот         |Достоевский Ф.М.|360.80|     3|
```

</details>

<details><summary>Таблица supply после</summary>

```text
supply_id|title|author|price|amount|
---------+-----+------+-----+------+
```

</details>

<p align="center">~~~</p>

Пример 2:

Удалить из таблицы supply все книги, названия которых есть в таблице book.

```sql
DELETE FROM supply
      WHERE title IN (  SELECT title
                          FROM book
                      GROUP BY title);
```

<details><summary>Результат вложенного запроса</summary>

```sql
  SELECT title
    FROM book
GROUP BY title;
```
```text
title                |
---------------------+
Мастер и Маргарита   |
Белая гвардия        | <-
Идиот                | <-
Братья Карамазовы    |
Игрок                |
Стихотворения и поэмы|
```

</details>

<details><summary>Таблица supply до</summary>

```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6|
        3|Белая гвардия |Булгаков М.А.   |540.50|     7| <-
        4|Идиот         |Достоевский Ф.М.|360.80|     3| <-
```

</details>

<details><summary>Таблица supply после</summary>

```text
supply_id|title         |author        |price |amount|
---------+--------------+--------------+------+------+
        1|Лирика        |Пастернак Б.Л.|518.99|     2|
        2|Черный человек|Есенин С.А.   |570.20|     6|
```

</details>

<p align="center">~~~</p>

Задание:

Удалить из таблицы supply книги тех авторов, общее количество экземпляров книг
которых в таблице book превышает 10.

```sql
DELETE FROM supply
      WHERE author IN (  SELECT author
                           FROM book
                       GROUP BY author
                         HAVING SUM(amount) > 10);
```

<details><summary>Результат вложенного запроса</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3|
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5|
      3|Идиот                |Достоевский Ф.М.|460.00|    10| <-23
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3| <-23
      5|Игрок                |Достоевский Ф.М.|480.50|    10| <-23
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15| <-15
```
```sql
  SELECT author
    FROM book
GROUP BY author
  HAVING SUM(amount) > 10;
```
```text
author          |
----------------+
Достоевский Ф.М.| <-23
Есенин С.А.     | <-15
```

</details>

<details><summary>Таблица supply до</summary>

```text
supply_id|title         |author          |price |amount|
---------+--------------+----------------+------+------+
        1|Лирика        |Пастернак Б.Л.  |518.99|     2|
        2|Черный человек|Есенин С.А.     |570.20|     6| <-X
        3|Белая гвардия |Булгаков М.А.   |540.50|     7|
        4|Идиот         |Достоевский Ф.М.|360.80|     3| <-X
```

</details>

<details><summary>Таблица supply после</summary>

```text
supply_id|title        |author        |price |amount|
---------+-------------+--------------+------+------+
        1|Лирика       |Пастернак Б.Л.|518.99|     2|
        3|Белая гвардия|Булгаков М.А. |540.50|     7|
```

</details>

---

<h3 id="8" align="center">Запросы на создание таблицы на основе другой таблицы</h3>

Синтаксис:

```sql
CREATE TABLE <tbl_name>
      SELECT <field_1>,
             ...,
             <field_n>
        FROM <tbl_name>
       WHERE <condition>
    GROUP BY <field>
      HAVING <condition>
    ORDER BY <field>
       LIMIT <limit>;
```

<p align="center">~~~</p>

Пример 1:

Создать таблицу ordering, куда включить авторов и названия тех книг, количество
экземпляров которых в таблице book меньше 4. Для всех книг указать одинаковое
количество экземпляров 5.

```sql
CREATE TABLE IF NOT EXISTS ordering
                    SELECT author,
                           title,
                           5 AS amount
                      FROM book
                     WHERE amount < 4;
```

<details><summary>Таблица book</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3| <-
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5|
      3|Идиот                |Достоевский Ф.М.|460.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3| <-
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```

</details>

<details><summary>Новая таблица ordering</summary>

```sql
SELECT * FROM ordering;
```
```text
author          |title             |amount|
----------------+------------------+------+
Булгаков М.А.   |Мастер и Маргарита|     5|
Достоевский Ф.М.|Братья Карамазовы |     5|
```

</details>

<p align="center">~~~</p>

> При создании таблицы можно использовать вложенные запросы.

Пример 2:

Создать таблицу ordering, куда включить авторов и названия тех книг, количество
экземпляров которых в таблице book меньше 4. Для всех книг указать одинаковое
значение - среднее количество экземпляров книг в таблице book.

```sql
CREATE TABLE IF NOT EXISTS ordering
                    SELECT author,
                           title,
                           (SELECT ROUND(AVG(amount), 0)
                              FROM book) AS amount
                      FROM book
                     WHERE amount < 4;
```

<details><summary>Таблица book</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3| <-
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5|
      3|Идиот                |Достоевский Ф.М.|460.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3| <-
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```

</details>

<details><summary>Результат вложенного запроса</summary>

```sql
SELECT ROUND(AVG(amount), 0)
  FROM book;
```
```text
ROUND(AVG(amount))|
------------------+
                 8|
```

</details>

<details><summary>Новая таблица ordering</summary>

```sql
SELECT * FROM ordering;
```
```text
author          |title             |amount|
----------------+------------------+------+
Булгаков М.А.   |Мастер и Маргарита|     8|
Достоевский Ф.М.|Братья Карамазовы |     8|
```

</details>

<p align="center">~~~</p>

Задание:

Создать таблицу ordering, куда включить авторов и названия тех книг, количество
экземпляров которых в таблице book меньше среднего количества экземпляров книг
в таблице book. В таблицу включить столбец amount, в котором для всех книг
указать одинаковое значение - среднее количество экземпляров книг в таблице
book.

```sql
CREATE TABLE IF NOT EXISTS ordering
                    SELECT author,
                           title,
                           ROUND(@avg_amount, 0) AS amount
                      FROM book
                     WHERE (SELECT @avg_amount := AVG(amount)
                              FROM book)
                       AND amount < @avg_amount;
```

<details><summary>Результат вложенного запроса</summary>

```sql
SELECT @avg_amount := AVG(amount)
  FROM book;
```
```text
@avg_amount := AVG(amount)|
--------------------------+
                    7.6667|
```

</details>

<details><summary>Таблица book</summary>

```text
book_id|title                |author          |price |amount|
-------+---------------------+----------------+------+------+
      1|Мастер и Маргарита   |Булгаков М.А.   |670.99|     3| <-
      2|Белая гвардия        |Булгаков М.А.   |540.50|     5| <-
      3|Идиот                |Достоевский Ф.М.|460.00|    10|
      4|Братья Карамазовы    |Достоевский Ф.М.|799.01|     3| <-
      5|Игрок                |Достоевский Ф.М.|480.50|    10|
      6|Стихотворения и поэмы|Есенин С.А.     |650.00|    15|
```

</details>

<details><summary>Новая таблица ordering</summary>

```sql
SELECT * FROM ordering;
```
```text
author          |title             |amount|
----------------+------------------+------+
Булгаков М.А.   |Мастер и Маргарита|     8|
Булгаков М.А.   |Белая гвардия     |     8|
Достоевский Ф.М.|Братья Карамазовы |     8|
```

</details>